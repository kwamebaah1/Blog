<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Two One Show</title>
    <link rel="stylesheet" href="index.css" />
    <link
      rel="icon"
      href="https://d3t3ozftmdmh3i.cloudfront.net/production/podcast_uploaded/8049352/8049352-1636130317778-cf3f4afff543c.jpg"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Quicksand&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://kit.fontawesome.com/0bd60f23a3.js"></script>
</head>
<body>
    <header>
        <!-- Header content -->
    </header>

    <div id="icons">
        <!-- Your other icons here -->
        <span id="addBookIcon" class="icon" onclick="togglePasswordSection()">&#43;</span>
    </div>
    <div id="passwordSection" style="display: none;">
        <input type="password" id="password" name="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
    </div>

    <div id="addBookSection" style="display: none;">
        <!-- Form to upload book -->
    </div>

    <div id="bookList">
        <!-- Display uploaded books here -->
    </div>

    <script>
        // Function to toggle password section
        async function togglePasswordSection() {
            try {
                const response = await fetch('/.netlify/functions/togglePasswordSection', {
                    method: 'POST'
                });
                if (response.ok) {
                    // Toggle password section based on response
                    const { display } = await response.json();
                    const passwordSection = document.getElementById('passwordSection');
                    passwordSection.style.display = display ? 'block' : 'none';
                } else {
                    console.error('Failed to toggle password section:', response.statusText);
                }
            } catch (error) {
                console.error('Error toggling password section:', error);
            }
        }

        // Function to check password
        async function checkPassword() {
            const password = document.getElementById('password').value;
            try {
                const response = await fetch('/.netlify/functions/checkPassword', {
                    method: 'POST',
                    body: JSON.stringify({ password }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    // Handle successful password check
                    const { valid } = await response.json();
                    if (valid) {
                        const addBookSection = document.getElementById('addBookSection');
                        addBookSection.style.display = 'block';
                    } else {
                        alert('Incorrect password. Please try again.');
                    }
                } else {
                    console.error('Failed to check password:', response.statusText);
                }
            } catch (error) {
                console.error('Error checking password:', error);
            }
        }

        // Function to cancel adding a book
        function cancelAddBook() {
            const addBookSection = document.getElementById('addBookSection');
            addBookSection.style.display = 'none';

            togglePasswordSection(); // Reset password section display
        }

        // Function to display uploaded book
        function displayBook(book) {
            // Update UI to display book information
            const bookElement = document.createElement('div');
            bookElement.classList.add('book');
            bookElement.innerHTML = `
                <div class="description">
                    <h3>${book.title}</h3>
                    <p>${book.description}</p>
                    <a href="${book.downloadLink}" class="download-button" download>Download</a>
                </div>
                <img src="${book.imageUrl}" alt="${book.title}">
            `;
            document.getElementById('bookList').appendChild(bookElement);
        }

        // Add event listener for book upload form submission
        document.getElementById('bookUploadForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new FormData();
            formData.append('book', document.getElementById('bookFile').files[0]);
            formData.append('title', document.getElementById('bookTitle').value);
            formData.append('description', document.getElementById('bookDescription').value);
            formData.append('image', document.getElementById('bookImage').files[0]);

            try {
                const response = await fetch('/.netlify/functions/uploadBook', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const newBook = await response.json();
                    displayBook(newBook);
                    cancelAddBook();
                } else {
                    console.error('Upload failed:', response.statusText);
                }
            } catch (error) {
                console.error('Error uploading book:', error);
            }
        });
    </script>
</body>
</html>
